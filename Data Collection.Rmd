---
title: "Data Collection"
author: "Ellen Graham"
date: "November 4, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Gapminder data
```{r}
library(tidyr)

filenames <- list.files(path="GapMinderData",pattern="*.csv", full.names=TRUE)
contraceptive<-read_csv(filenames[[1]])

nchar(filenames[[1]])

(name<-substring(filenames[[1]], 15, nchar(filenames[[1]])-4))
contraceptive<-contraceptive %>% 
   gather(key=year, value=temp, 2:length(contraceptive))
colnames(contraceptive)[1]<-"country"
colnames(contraceptive)[3]<-name
contraceptive[contraceptive == 0] <- NA
head(contraceptive)
```

```{r}
makeGapMinderTable<-function(file_path){
   table<-read_csv(file_path)
   name<-substring(file_path, 15, nchar(file_path)-4)
   table<-table %>% 
      gather(key=year, value=temp, 2:length(table))
   table
   colnames(table)[1]<-"country"
   colnames(table)[3]<-name
   table[table == 0] <- NA
   table
}
```

```{r}
allGapminderTables<-lapply(filenames, makeGapMinderTable)
```


```{r}
library(ggplot2)
joined_Gapminder_tables<-allGapminderTables[[1]]
for(i in 2:length(allGapminderTables)){
      joined_Gapminder_tables<-full_join(joined_Gapminder_tables, allGapminderTables[[i]], by=c("country", "year"))
}

joined_Gapminder_tables<-joined_Gapminder_tables %>% 
   select(-age_at_1st_marriage_women)

dim(joined_Gapminder_tables)
na_free_table<-na.omit(joined_Gapminder_tables)
table(na_free_table$country)
table(na_free_table$year)

na_free_table %>%
   group_by(year) %>% 
   filter( females_aged_15plus_unemployment_rate_percent/males_aged_15plus_unemployment_rate_percent<20,n()>5) %>% 
   ggplot(aes(x=contraceptive_use_percent_of_women_ages_15_49, y=life_expectancy_female, color=year))+
   geom_point()+
   geom_smooth(method="lm")

#change
```


```{r}
head(na_free_table)

```




